package duomenys.mitybai;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;

import java.util.List;
import java.util.Optional;


@Controller
public class PageController {
	@Autowired // This means to get the bean called userRepository
    // Which is auto-generated by Spring, we will use it to handle the data
	private ProduktaiRepository produktai_rep;
	@Autowired // This means to get the bean called userRepository
    // Which is auto-generated by Spring, we will use it to handle the data	
	private Maistines_medzRepository maistines_medz_rep;
	@Autowired // This means to get the bean called userRepository
    // Which is auto-generated by Spring, we will use it to handle the data	
	private Maisto_medz_grupesRepository maisto_medz_grupes_rep;
	@Autowired // This means to get the bean called userRepository
    // Which is auto-generated by Spring, we will use it to handle the data	
	private Produktai_medziagosRepository produktai_medziagos_rep;

	
	@RequestMapping(path="/produktai", method={ RequestMethod.GET, RequestMethod.POST })
    public String produktai(
    		@RequestParam(name="id", required=false, defaultValue="") Integer id
    		, @RequestParam(name="pav", required=false, defaultValue="") String pav
    		, @RequestParam(name="pildyti", required=false, defaultValue="nepildyti") String pildyti
    		, @RequestParam(name="keisti", required=false, defaultValue="nekeisti") String keisti
    		, @RequestParam(name="salinti", required=false, defaultValue="nesalinti") String salinti
    		, Model model 
    	) {
        
		System.out.println ( "pav: " + pav  );
		System.out.println ( "pildyti: " + pildyti );
		
		BackEndMessage back_end_message = new BackEndMessage ( "nieko dar neveikem", false, "pranesimas_grey" );
		
        if ( pildyti.equals("papildyti") ) {
        	
        	List<Produktai> lst_prod = produktai_rep.findByPav(pav);
        	
        	if ( lst_prod.size() > 0 ) {
        		
        		back_end_message.setMessage( "produktas su tokiu pav '" + pav + "' jau egzistuoja" );
        		back_end_message.setCss_class( "pranesimas_red" );
        		
        	} else {
        		
	        	Produktai produktas = new Produktai( id, pav );
	        	produktai_rep.save( produktas );
        		back_end_message.setMessage( "sara≈°as papildytas produktu '" + pav + "'" );
        		back_end_message.setCss_class( "pranesimas_green" );	        	
        	}
        }
        
        if ( keisti.equals("pakeisti") ) {
        	
        	Produktai produktas = new Produktai();// id, pav;
        	Optional <Produktai> found = produktai_rep.findById( id );
        	
        	if ( found.isPresent() ) {
    			
        		produktas = found.get();
        		produktas.setId(id);
        		produktas.setPav(pav);
        		produktai_rep.save(produktas);
        	}

        }
        if ( salinti.equals("pasalinti") ) {
        	
        	Optional <Produktai> found = produktai_rep.findById( id );
        	
        	if ( found.isPresent() ) {
    			
        	//Produktai produktas = found.get();
        		produktai_rep.deleteById(id);
 		
 			}
        }
        model.addAttribute( "back_end_message", back_end_message );
        model.addAttribute( "lst_menu", Menu.values() ); 
        model.addAttribute( "lst", produktai_rep.findAll() );
        
        
        return "produktas";
    }	
	@RequestMapping(path="/maistines_medz", method={ RequestMethod.GET, RequestMethod.POST })
    public String maistines_medz(
    		@RequestParam(name="id", required=false, defaultValue="") Integer id
    		, @RequestParam(name="pav", required=false, defaultValue="") String pav
    		, @RequestParam(name="id_grupes", required=false, defaultValue="") Integer id_grupes
    		, @RequestParam(name="pildyti", required=false, defaultValue="nepildyti") String pildyti
    		, @RequestParam(name="keisti", required=false, defaultValue="nekeisti") String keisti
    		, @RequestParam(name="salinti", required=false, defaultValue="nesalinti") String salinti
    		, Model model 
    	) {
        
        if ( pildyti.equals("papildyti") ) {
        	
        	Maistines_medz maistine_medz = new Maistines_medz( id, pav, id_grupes );
        	maistines_medz_rep.save( maistine_medz );
        }
        if ( keisti.equals("pakeisti") ) {
        	Maistines_medz maistine_medz = new Maistines_medz();// id, pav;
        	Optional <Maistines_medz> found = maistines_medz_rep.findById( id );
        	
        	if ( found.isPresent() ) {
    			
        		maistine_medz = found.get();
        		maistine_medz.setId(id);
        		maistine_medz.setPav(pav);
        		maistines_medz_rep.save(maistine_medz);
        	}

        }
        if ( salinti.equals("pasalinti") ) {
        	
        	Optional <Maistines_medz> found = maistines_medz_rep.findById( id );
        	
        	if ( found.isPresent() ) {
    			
        	//Maistines_medz maistine_medz = found.get();
        	maistines_medz_rep.deleteById(id);
 		
 			}
 
        }
        model.addAttribute("lst_menu", Menu.values() ); 
        model.addAttribute("lst", maistines_medz_rep.findAll() );
        
        return "maistine_medz";
    }
	@RequestMapping(path="/maisto_medz_grupes", method={ RequestMethod.GET, RequestMethod.POST })
    public String maisto_medz_grupes(
    		@RequestParam(name="id", required=false, defaultValue="") Integer id
    		, @RequestParam(name="pav", required=false, defaultValue="") String pav
    		, @RequestParam(name="pildyti", required=false, defaultValue="nepildyti") String pildyti
    		, @RequestParam(name="keisti", required=false, defaultValue="nekeisti") String keisti
    		, @RequestParam(name="salinti", required=false, defaultValue="nesalinti") String salinti
    		, Model model 
    	) {
        
        if ( pildyti.equals("papildyti") ) {
        	
        	Maisto_medz_grupes maisto_medz_grupe = new Maisto_medz_grupes( id, pav );
        	maisto_medz_grupes_rep.save( maisto_medz_grupe );
        }
        if ( keisti.equals("pakeisti") ) {
        	Maisto_medz_grupes maisto_medz_grupe = new Maisto_medz_grupes();// id, pav );
        	Optional <Maisto_medz_grupes> found = maisto_medz_grupes_rep.findById( id );
        	
        	if ( found.isPresent() ) {
    			
        		maisto_medz_grupe = found.get();
        		maisto_medz_grupe.setId(id);
        		maisto_medz_grupe.setPav(pav);
        		maisto_medz_grupes_rep.save(maisto_medz_grupe);
        	}

        }
        if ( salinti.equals("pasalinti") ) {
        	
        	Optional <Maisto_medz_grupes> found = maisto_medz_grupes_rep.findById( id );
        	
        	if ( found.isPresent() ) {
    			
        	//Maisto_medz_grupes maisto_medz_grupe = found.get();
        	maisto_medz_grupes_rep.deleteById(id);
 		
 			}
 
        }
        model.addAttribute("lst_menu", Menu.values() ); 
        model.addAttribute("lst", maisto_medz_grupes_rep.findAll() );
        
        return "maisto_medz_grupe";
    }
	@RequestMapping(path="/", method={ RequestMethod.GET, RequestMethod.POST })
    public String index(Model model) {
        
	
        model.addAttribute("lst_menu", Menu.values() ); 
        
        return "index";
    }	
	
	@RequestMapping(path="/produktai_medziagos", method={ RequestMethod.GET, RequestMethod.POST })
    public String produktai_medziagos(
    		@RequestParam(name="id", required=false, defaultValue="") Integer id
    		, @RequestParam(name="id_produkto", required=false, defaultValue="") Integer id_produkto
    		, @RequestParam(name="id_medziagos", required=false, defaultValue="") Integer id_medziagos
    		, @RequestParam(name="kiekis", required=false, defaultValue="0") Double kiekis
    		, @RequestParam(name="pildyti", required=false, defaultValue="nepildyti") String pildyti
    		, @RequestParam(name="keisti", required=false, defaultValue="nekeisti") String keisti
    		, @RequestParam(name="salinti", required=false, defaultValue="nesalinti") String salinti
    		, Model model 
    	) {
        
        if ( pildyti.equals("papildyti") ) {
        	
        	Produktai_medziagos produktas_medziaga = new Produktai_medziagos( id, id_produkto, id_medziagos, kiekis);
        	produktai_medziagos_rep.save( produktas_medziaga );
        }
      
        if ( keisti.equals("pakeisti") ) {
        	Produktai_medziagos produktas_medziaga = new Produktai_medziagos();// id, id_produkto, id_medziagos, kiekis );
        	Optional <Produktai_medziagos> found = produktai_medziagos_rep.findById( id );
        	
        	if ( found.isPresent() ) {
    			
	        	produktas_medziaga = found.get();
	        	produktas_medziaga.setId(id);
	        	produktas_medziaga.setProduktai_id(id_produkto);
	        	produktas_medziaga.setMaistines_medz_id(id_medziagos);
	        	produktas_medziaga.setKiekis(kiekis);
	        	produktai_medziagos_rep.save(produktas_medziaga);
        	}

        }
        if ( salinti.equals("pasalinti") ) {
        	
        	Optional <Produktai_medziagos> found = produktai_medziagos_rep.findById( id );
        	
        	if ( found.isPresent() ) {
    			
        	//Produktai_medziagos produktas_medziaga = found.get();
        	produktai_medziagos_rep.deleteById(id);
 		
 			}
  
        }
        model.addAttribute("lst_menu", Menu.values() ); 
        model.addAttribute("lst", produktai_medziagos_rep.findAll() );
        
        return "produktas_medziaga";
    }
}
